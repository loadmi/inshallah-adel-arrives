<div class="statistics-page">
  <!-- Page Header -->
  <header class="page-header">
    <h1 class="page-title">Statistics Dashboard</h1>
    <p class="page-subtitle">Analyzing Adel's temporal patterns and arrival trends</p>
  </header>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="skeleton-grid">
        @for (i of [1, 2, 3, 4, 5, 6]; track i) {
          <div class="skeleton-card">
            <div class="skeleton-icon"></div>
            <div class="skeleton-label"></div>
            <div class="skeleton-value"></div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-error">
      <span class="error-icon">âš ï¸</span>
      {{ error() }}
    </div>
  }

  <!-- Statistics Content -->
  @if (stats()) {
    <!-- Key Metrics Grid -->
    <section class="metrics-section">
      <h2 class="section-title">Key Metrics</h2>
      <div class="stats-grid">
        <!-- Total Entries Card -->
        <div class="stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-content">
            <span class="stat-label">Total Entries</span>
            <span class="stat-value">{{ stats()!.overall.totalEntries }}</span>
          </div>
        </div>

        <!-- Average Delay Card -->
        <div class="stat-card" [class.status-warning]="stats()!.overall.averageDelay > 10" [class.status-success]="stats()!.overall.averageDelay <= 5">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-content">
            <span class="stat-label">Average Delay</span>
            <span class="stat-value">{{ stats()!.overall.averageDelay }}<span class="stat-unit">min</span></span>
          </div>
          <div class="stat-indicator" [class.indicator-good]="stats()!.overall.averageDelay <= 5" [class.indicator-warning]="stats()!.overall.averageDelay > 5 && stats()!.overall.averageDelay <= 10" [class.indicator-bad]="stats()!.overall.averageDelay > 10">
            @if (stats()!.overall.averageDelay <= 5) {
              <span class="indicator-icon">âœ“</span>
            } @else if (stats()!.overall.averageDelay <= 10) {
              <span class="indicator-icon">â—‹</span>
            } @else {
              <span class="indicator-icon">!</span>
            }
          </div>
        </div>

        <!-- Median Delay Card -->
        <div class="stat-card">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-content">
            <span class="stat-label">Median Delay</span>
            <span class="stat-value">{{ stats()!.overall.medianDelay }}<span class="stat-unit">min</span></span>
          </div>
        </div>

        <!-- On-Time Percentage Card -->
        <div class="stat-card stat-card-highlight" [class.status-success]="stats()!.overall.onTimePercentage >= 70" [class.status-warning]="stats()!.overall.onTimePercentage >= 40 && stats()!.overall.onTimePercentage < 70" [class.status-error]="stats()!.overall.onTimePercentage < 40">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-content">
            <span class="stat-label">On Time (â‰¤5 min)</span>
            <span class="stat-value stat-value-large">{{ stats()!.overall.onTimePercentage | number:'1.0-1' }}<span class="stat-unit">%</span></span>
          </div>
          <div class="progress-ring">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path class="circle" [attr.stroke-dasharray]="stats()!.overall.onTimePercentage + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
          </div>
        </div>

        <!-- Maximum Delay Card -->
        <div class="stat-card" [class.status-error]="stats()!.overall.maxDelay > 30">
          <div class="stat-icon">ğŸ“</div>
          <div class="stat-content">
            <span class="stat-label">Maximum Delay</span>
            <span class="stat-value">{{ stats()!.overall.maxDelay }}<span class="stat-unit">min</span></span>
          </div>
        </div>

        <!-- Trend Card -->
        <div class="stat-card stat-card-trend" [class.trend-improving]="stats()!.recentTrend.improving" [class.trend-declining]="!stats()!.recentTrend.improving">
          <div class="stat-icon trend-icon">
            @if (stats()!.recentTrend.improving) {
              ğŸ“ˆ
            } @else {
              ğŸ“‰
            }
          </div>
          <div class="stat-content">
            <span class="stat-label">Recent Trend</span>
            <span class="stat-value trend-text">
              @if (stats()!.recentTrend.improving) {
                Improving!
              } @else {
                Declining
              }
            </span>
          </div>
          <div class="trend-details">
            <span class="trend-comparison">
              <span class="trend-current">Last 10: {{ stats()!.recentTrend.last10Average }}m</span>
              <span class="trend-arrow">
                @if (stats()!.recentTrend.improving) {
                  â†“
                } @else {
                  â†‘
                }
              </span>
              <span class="trend-previous">Prev 10: {{ stats()!.recentTrend.previous10Average }}m</span>
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- Day of Week Statistics -->
    @if (stats()!.byDay.length > 0) {
      <section class="day-stats-section">
        <h2 class="section-title">Performance by Day of Week</h2>
        <div class="day-stats-card">
          <div class="day-stats-grid">
            @for (day of stats()!.byDay; track day.dayOfWeek) {
              <div class="day-item">
                <div class="day-header">
                  <span class="day-name">{{ day.dayName }}</span>
                  <span class="day-count">{{ day.count }} entries</span>
                </div>
                <div class="day-bar-wrapper">
                  <div class="day-bar" 
                       [style.width.%]="getBarWidth(day.averageDelay)"
                       [class.bar-good]="day.averageDelay <= 5"
                       [class.bar-warning]="day.averageDelay > 5 && day.averageDelay <= 10"
                       [class.bar-bad]="day.averageDelay > 10">
                  </div>
                </div>
                <div class="day-value">
                  <span class="delay-value">{{ day.averageDelay }}</span>
                  <span class="delay-unit">min avg</span>
                </div>
              </div>
            }
          </div>
        </div>
      </section>
    }

    <!-- Additional Stats Card -->
    <section class="additional-stats-section">
      <h2 class="section-title">Additional Insights</h2>
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-icon">ğŸ“‰</div>
          <div class="insight-content">
            <span class="insight-label">Minimum Delay</span>
            <span class="insight-value">{{ stats()!.overall.minDelay }} min</span>
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-icon">ğŸ“Š</div>
          <div class="insight-content">
            <span class="insight-label">Std. Deviation</span>
            <span class="insight-value">{{ stats()!.overall.standardDeviation | number:'1.0-1' }} min</span>
          </div>
        </div>
      </div>
    </section>
  }

  <!-- Empty State -->
  @if (!loading() && !error() && !stats()) {
    <div class="empty-state">
      <div class="empty-icon">ğŸ“­</div>
      <h3 class="empty-title">No Statistics Available</h3>
      <p class="empty-message">Start recording time entries to see your statistics here.</p>
      <a routerLink="/record" class="btn-primary">Record First Entry</a>
    </div>
  }
</div>
